language: node_js

node_js:
  - lts/*

cache: yarn

before_script:
  - git clone https://github.com/zowiegong/hexo-theme-os.git themes/os
  - sed  "s/{TOKEN}/${GITHUB_TOKEN}/" _config.yml > _config.yml.temp
  - mv _config.yml.temp _config.yml
  - sed  "s/{DATE}/$(date +%s)/" themes/os/source/sw.js > themes/os/source/_sw.js
  - mv themes/os/source/_sw.js themes/os/source/sw.js

script: yarn deploy

after_script:
  - curl https://www.google.com/ping?sitemap=https://zowiegong.com/sitemap.xml
  - curl -X POST 'http://ping.baidu.com/ping/RPC2' --header "Content-Type:text/xml" -d "<?xml version="1.0"?><methodCall><methodName>weblogUpdates.ping</methodName><params><param><value><string>https://zowiegong.com/atom.xml</string></value></param><param><value><string>https://zowiegong.com/atom.xml</string></value></param></params></methodCall>"
