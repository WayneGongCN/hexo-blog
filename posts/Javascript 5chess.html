<!DOCTYPE html><html lang="en"><title>Javascript 五子棋 - OS</title><meta charset="utf-8"><meta name="description"content="Javascript 五子棋"><meta name="keywords"><meta name="subtitle"content="Code &amp; Life"><meta name="author"content="zowiegong"><meta name="language"content="zh-CN"><meta name="timezone"content="Asia/Shanghai"><meta name="viewport"content="width=device-width,initial-scale=1"><link href="/manifest.json"rel="manifest"><link href="/atom.xml"rel="alternate"type="application/atom+xml"><link href="/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="/css/style.css"rel="stylesheet"><link href="/css/post.css"rel="stylesheet"><meta name="generator"content="Hexo 4.2.0"><header id="header-container"><h1 id="blog-title"><a href="/">OS</a></h1><nav><ul class="menu-list"><li class="menu-list-item"><a href="/categories"class="menu-name">categories</a><li class="menu-list-item"><a href="/tags"class="menu-name">tags</a><li class="menu-list-item"><a href="/about"class="menu-name">about</a></ul></nav></header><article class="main"><h1 id="post-title">Javascript 五子棋</h1><div class="post-info"><time class="post-date">2017-09-21</time><ul class="tag-list"><li class="tag-item"><a href="/tags/javascript/"class="tag-name">#javascript</a></ul></div><section class="markdown-body"><h2 id="简单的-Javascript-五子棋-Demo"><a href="#简单的-Javascript-五子棋-Demo"class="headerlink"title="简单的 Javascript 五子棋 Demo"></a>简单的 Javascript 五子棋 Demo</h2><hr><p>Dome:<a href="https://zowiegong.github.io/javascript-five-chess/"target="_blank"rel="noopener">https://zowiegong.github.io/javascript-five-chess/</a><p>Repo:<a href="https://github.com/helloAwei/javascript-five-chess"target="_blank"rel="noopener">https://github.com/helloAwei/javascript-five-chess</a><h3 id="简介"><a href="#简介"class="headerlink"title="简介"></a>简介</h3><ul><li>实现胜负判断，并给出赢棋提示。<li>界面用 DOM 实现<li>实现悔棋</ul><p>前端用<a href="http://knockoutjs.com/"target="_blank"rel="noopener">Knockout</a>做双向绑定。<p>思路：用一个二维数组生成棋盘，对格子添加点击事件，用一个布尔值进行切换黑白轮流落子，落子后对当前棋子进行胜负判断 …<h3 id="生成二维数组"><a href="#生成二维数组"class="headerlink"title="生成二维数组"></a>生成二维数组</h3><pre><code class="javascript">function GeneratorList() {
    let array = new Array(ROW).fill(null);

    //生成二维数组
    let result = array.map((value, y) =&gt; {
        return array.map((value, x) =&gt; {
            return {
                hasChess: ko.observable(false),
                value: ko.observable(null),
                x: x,
                y: y
            }
        });
    });
    return result;
}</code></pre><p>生成一个 15*15 的二维数组，<code>List[y][x]</code>能取到对应格子的状态。<br>初始的状态为：<pre><code class="javascript">{
    hasChess: ko.observable(false),    //是否有棋子
    value: ko.observable(null),        //棋子的值（黑或白）
    x: x,                              //坐标
    y: y
}</code></pre><p>这里没有单独去定义一个棋子类，直接用的字面量形式。<h3 id="落子"><a href="#落子"class="headerlink"title="落子"></a>落子</h3><pre><code class="javascript">ViewModel.prototype.down = function (data) {
    if (data.hasChess()) return;
    if (this.winer()) this.rePlay();
    // change
    data.hasChess(true);
    data.value(this.isBlack() ? &#39;X&#39; : &#39;O&#39;);

    // add history
    this.history.push({
        x: data.x,
        y: data.y
    });

    //判断输赢
    this.referee(data);

    //换手
    this.isBlack(!this.isBlack());
}</code></pre><p>落子前进行判断，落子，然后添加一条历史记录，判断输赢，换手。。。<h3 id="判断输赢的算法"><a href="#判断输赢的算法"class="headerlink"title="判断输赢的算法"></a>判断输赢的算法</h3><pre><code class="javascript">ViewModel.prototype.referee = function (item) {
    //四个方向
    let change = [[0, -1], [-1, 0], [-1, -1], [1, -1]];

    change.forEach(c =&gt; {
        //朝某个方向递归
        this.test(item, c);

        //不足五连珠朝反方向递归
        if (this.lineTotal &lt;= 4) {
            //反方向
            let reveis = c.map(x =&gt; {
                return x * -1;
            });

            this.test(item, reveis)
            this.lineTotal = 0
        };
    })
}</code></pre><p>判断胜负需要检查一个棋子的八个方向上有无五连珠的情况。<br><img alt=""src="http://ofl97l8av.bkt.clouddn.com/17-9-22/69929859.jpg"><p><code>change</code>是一个保存了四个检查方向的二维数组。<br>在朝某个方向检查完之后然后反向的检查，这样能够将八个方向缩减为四个。<br>例： 1、2、3、4 反向后对应 5、6、7、8<p>如果某个方向不满足五连珠的情况（代码中为&lt;=4，因为检查不包括本身），则向反向的方向进行检查。<p>下面是一个递归检查的方法：<pre><code class="javascript">//判断连子
ViewModel.prototype.test = function (item, change, total = 0) {
    let cx = item.x + change[0];
    let cy = item.y + change[1];

    let isInBoard = (cx &gt;= 0 &amp;&amp; cx &lt;= ROW - 1) &amp;&amp; (cy &gt;= 0 &amp;&amp; cy &lt;= ROW - 1);
    let cItem = isInBoard &amp;&amp; this.allBoxs()[cy][cx];
    let isNull = cItem !== null;

    if (isNull &amp;&amp;
        isInBoard &amp;&amp;
        item.value() === cItem.value()
    ) {
        total += 1;
        //递归
        this.test(cItem, change, total);
    } else {
        //跳出
        this.lineTotal += total;
    }

    //win
    if (this.lineTotal &gt;= 4) {
        this.win();
    };
}</code></pre><p>直到下一个棋子不是与本身同类型的棋子便跳出递归，同时将<code>total</code>返回。<p>完。</section></article><footer class="footer-container"><section>Copyright &copy; 2020&nbsp;<a href="mailto:zowiegong@gmail.com">zowiegong</a>&nbsp;Powered by&nbsp;<a href="https://github.com/hexojs/hexo"target="_blank"rel="noopener noreferrer">Hexo</a>&nbsp;Theme by&nbsp;<a href="https://github.com/zowiegong/hexo-theme-os"target="_blank"rel="noopener noreferrer">OS.</a><br><a href="https://github.com/zowiegong/hexo-blog/edit/master/source/_posts/Javascript 5chess.md"target="_blank">Edit source file</a></section></footer><div class="hover-pointer"id="scroll-to-top-container"><svg class="hover-fill"height="3rem "id="scroll-to-top-btn"version="1.1"viewBox="0 0 1024 1024"width="3rem"><path d="M825.568 555.328l-287.392-289.28C531.808 259.648 523.488 256.576 515.2 256.64 514.08 256.544 513.12 256 512 256c-4.672 0-9.024 1.088-13.024 2.88-4.032 1.536-7.872 3.872-11.136 7.136l-259.328 258.88c-12.512 12.48-12.544 32.736-0.032 45.248 6.24 6.272 14.432 9.408 22.656 9.408 8.192 0 16.352-3.136 22.624-9.344L480 364.288 480 928c0 17.696 14.336 32 32 32s32-14.304 32-32L544 362.72l236.192 237.728c6.24 6.272 14.496 9.44 22.688 9.44s16.32-3.104 22.56-9.312C838.016 588.128 838.048 567.84 825.568 555.328z"p-id="1100"></path><path d="M864 192 160 192C142.336 192 128 177.664 128 160s14.336-32 32-32l704 0c17.696 0 32 14.336 32 32S881.696 192 864 192z"p-id="1101"></path></svg></div><script>window.pluginsConfig = JSON.parse('{"googleAnalytics":"UA-121105508-1","scrollToTop":true,"scrollSmooth":false,"comments":{"enable":true,"repo":"zowiegong/hexo-blog"}}')</script><script>pluginsConfig.comments.enable = true</script><script src="/main.js"></script>