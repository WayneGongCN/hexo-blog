<!DOCTYPE html><html lang="en"><title>双虚拟机隔离中网关机的配置 - OS</title><meta charset="utf-8"><meta name="description"content="双虚拟机隔离中网关机的配置"><meta name="keywords"><meta name="subtitle"content="Code &amp; Life"><meta name="author"content="zowiegong"><meta name="language"content="zh-CN"><meta name="timezone"content="Asia/Shanghai"><meta name="viewport"content="width=device-width,initial-scale=1"><link href="/manifest.json"rel="manifest"><link href="/atom.xml"rel="alternate"type="application/atom+xml"><link href="/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="/css/style.css"rel="stylesheet"><link href="/css/post.css"rel="stylesheet"><meta name="generator"content="Hexo 4.2.0"><header id="header-container"><h1 id="blog-title"><a href="/">OS</a></h1><nav><ul class="menu-list"><li class="menu-list-item"><a href="/categories"class="menu-name">categories</a><li class="menu-list-item"><a href="/tags"class="menu-name">tags</a><li class="menu-list-item"><a href="/about"class="menu-name">about</a></ul></nav></header><article class="main"><h1 id="post-title">双虚拟机隔离中网关机的配置</h1><div class="post-info"><time class="post-date">2018-06-10</time><ul class="tag-list"><li class="tag-item"><a href="/tags/privacy/"class="tag-name">#privacy</a></ul></div><section class="markdown-body"><h2><a href="#2018-04-03-%E6%9B%B4%E6%96%B0"class="anchor"aria-hidden="true"id="user-content-2018-04-03-更新"><span class="octicon octicon-link"aria-hidden="true"></span></a>2018-04-03 更新</h2><p>推荐使用<a href="https://www.whonix.org/"target="_blank"rel="nofollow noopener">whonix</a>,安全性更高，基本免配置开箱即用。<hr><h2><a href="#%E4%BD%BF%E7%94%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BF%9D%E6%8A%A4%E9%9A%90%E7%A7%81"class="anchor"aria-hidden="true"id="user-content-使用虚拟机保护隐私"><span class="octicon octicon-link"aria-hidden="true"></span></a>使用虚拟机保护隐私</h2><p>更多内容，见<a href="https://program-think.blogspot.com/2015/04/howto-cover-your-tracks-8.html"target="_blank"rel="nofollow noopener">如何搭配“多重代理”和“多虚拟机”</a><h2><a href="#%E5%8F%8C%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%96%B9%E6%A1%88"class="anchor"aria-hidden="true"id="user-content-双虚拟机方案"><span class="octicon octicon-link"aria-hidden="true"></span></a>双虚拟机方案</h2><p>网关机器使用两张网卡，<code>网络地址转换(NAT)</code>网卡与宿主机连接访问不安全的网络，<code>Host-Only</code>与需要上网的机器连接通过网关机内的代理端口上网。<h2><a href="#%E7%BD%91%E5%85%B3%E6%9C%BA%E7%9A%84%E9%85%8D%E7%BD%AE"class="anchor"aria-hidden="true"id="user-content-网关机的配置"><span class="octicon octicon-link"aria-hidden="true"></span></a>网关机的配置</h2><ul><li><p>系统:<ul><li><a href="https://www.ubuntu.com/download/server"target="_blank"rel="nofollow noopener">Ubuntu 18 server</a></ul><li><p>VirtualBox:<ul><li>硬盘、CPU、内存按需分配，<li>网卡1<code>Host-Only</code>, 网卡2<code>网络地址转换(NAT)</code>。</ul><li><p>更新<ul><li><code>sudo apt update</code><li><code>sudo apt upgrade</code></ul></ul><h4><a href="#%E5%AE%89%E8%A3%85-shadowsocks"class="anchor"aria-hidden="true"id="user-content-安装-shadowsocks"><span class="octicon octicon-link"aria-hidden="true"></span></a>安装 shadowsocks</h4><pre><code>sudo apt-get install python-pip
pip install git+https://github.com/shadowsocks/shadowsocks.git@master
</code></pre><h4><a href="#%E9%85%8D%E7%BD%AE-sslocal"class="anchor"aria-hidden="true"id="user-content-配置-sslocal"><span class="octicon octicon-link"aria-hidden="true"></span></a>配置 sslocal</h4><p>配置文件：<code>/etc/shadowsocks/sslocal.json</code><div class="highlight highlight-source-json"><pre>{
    <span class="pl-s"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>my_server_ip<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>server_port<span class="pl-pds">"</span></span>: <span class="pl-c1">8388</span>,
    <span class="pl-s"><span class="pl-pds">"</span>local_address<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>127.0.0.1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>local_port<span class="pl-pds">"</span></span>: <span class="pl-c1">1080</span>,
    <span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>mypassword<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>timeout<span class="pl-pds">"</span></span>: <span class="pl-c1">300</span>,
    <span class="pl-s"><span class="pl-pds">"</span>method<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>aes-256-cfb<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>fast_open<span class="pl-pds">"</span></span>: <span class="pl-c1">false</span>
}</pre></div><h4><a href="#sslocal-%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8"class="anchor"aria-hidden="true"id="user-content-sslocal-开机启动"><span class="octicon octicon-link"aria-hidden="true"></span></a>sslocal 开机启动</h4><p>配置文件：<code>/etc/systemd/system/sslocal.service</code><pre><code>[Unit]
Description=Daemon to start Shadowsocks Client
Wants=network-online.target
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/sslocal -c /etc/shadowsocks/sslocal.json --pid-file /var/run/sslocal.pid --log-file /var/log/sslocal.log   

[Install]
WantedBy=multi-user.target
</code></pre><p>执行<code>systemctl enable /etc/systemd/system/shadowsocks.service</code><h4><a href="#%E5%AE%89%E8%A3%85-tor"class="anchor"aria-hidden="true"id="user-content-安装-tor"><span class="octicon octicon-link"aria-hidden="true"></span></a>安装 tor</h4><p><code>sudo apt install tor</code><h4><a href="#%E9%85%8D%E7%BD%AE-tor"class="anchor"aria-hidden="true"id="user-content-配置-tor"><span class="octicon octicon-link"aria-hidden="true"></span></a>配置 tor</h4><p>配置文件：<code>/etc/tor/torrc</code><pre><code>SOCKSPort 0.0.0.0:9050
Socks5Proxy 0.0.0.0:1080
</code></pre><p>tor 开机自启无需配置</section></article><footer class="footer-container"><section>Copyright &copy; 2020&nbsp;<a href="mailto:zowiegong@gmail.com">zowiegong</a>&nbsp;Powered by&nbsp;<a href="https://github.com/hexojs/hexo"target="_blank"rel="noopener noreferrer">Hexo</a>&nbsp;Theme by&nbsp;<a href="https://github.com/zowiegong/hexo-theme-os"target="_blank"rel="noopener noreferrer">OS.</a><br><a href="https://github.com/zowiegong/hexo-blog/edit/master/source/_posts/Dual VM gateway.md"target="_blank">Edit source file</a></section></footer><div class="hover-pointer"id="scroll-to-top-container"><svg class="hover-fill"height="3rem "id="scroll-to-top-btn"version="1.1"viewBox="0 0 1024 1024"width="3rem"><path d="M825.568 555.328l-287.392-289.28C531.808 259.648 523.488 256.576 515.2 256.64 514.08 256.544 513.12 256 512 256c-4.672 0-9.024 1.088-13.024 2.88-4.032 1.536-7.872 3.872-11.136 7.136l-259.328 258.88c-12.512 12.48-12.544 32.736-0.032 45.248 6.24 6.272 14.432 9.408 22.656 9.408 8.192 0 16.352-3.136 22.624-9.344L480 364.288 480 928c0 17.696 14.336 32 32 32s32-14.304 32-32L544 362.72l236.192 237.728c6.24 6.272 14.496 9.44 22.688 9.44s16.32-3.104 22.56-9.312C838.016 588.128 838.048 567.84 825.568 555.328z"p-id="1100"></path><path d="M864 192 160 192C142.336 192 128 177.664 128 160s14.336-32 32-32l704 0c17.696 0 32 14.336 32 32S881.696 192 864 192z"p-id="1101"></path></svg></div><script>let pluginsConfig = JSON.parse('{"googleAnalytics":"UA-121105508-1","scrollToTop":true,"scrollSmooth":false,"comments":{"enable":true,"repo":"zowiegong/hexo-blog"}}')</script><script>pluginsConfig.comments.enable = true</script><script src="/js/script.js"></script>