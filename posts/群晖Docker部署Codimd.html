<!DOCTYPE html><html lang="en"><title>群晖 Docker 部署 Codimd - OS</title><meta charset="utf-8"><meta name="description"content="群晖 Docker 部署 Codimd"><meta name="keywords"><meta name="subtitle"content="Code &amp; Life"><meta name="author"content="zowiegong"><meta name="language"content="zh-CN"><meta name="timezone"content="Asia/Shanghai"><meta name="viewport"content="width=device-width,initial-scale=1"><link href="/manifest.json"rel="manifest"><link href="/atom.xml"rel="alternate"type="application/atom+xml"><link href="/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="/css/style.css"rel="stylesheet"><link href="/css/post.css"rel="stylesheet"><meta name="generator"content="Hexo 4.2.0"><header id="header-container"><h1 id="blog-title"><a href="/">OS</a></h1><nav><ul class="menu-list"><li class="menu-list-item"><a href="/categories"class="menu-name">categories</a><li class="menu-list-item"><a href="/tags"class="menu-name">tags</a><li class="menu-list-item"><a href="/about"class="menu-name">about</a></ul></nav></header><article class="main"><h1 id="post-title">群晖 Docker 部署 Codimd</h1><div class="post-info"><time class="post-date">2020-03-22</time><ul class="tag-list"><li class="tag-item"><a href="/tags/Docker/"class="tag-name">#Docker</a><li class="tag-item"><a href="/tags/%E7%BE%A4%E6%99%96/"class="tag-name">#群晖</a></ul></div><section class="markdown-body"><h2 id="前言"><a href="#前言"class="headerlink"title="前言"></a>前言</h2><p>在线文档协同编辑有很多选择，但是大多都没有支持 Markdown。<p>发现一款 Markdown 在线协同编辑平台<a href="https://hackmd.io"target="_blank"rel="noopener">hackmd</a>（貌似打不开），社区免费版叫做<a href="https://github.com/hackmdio/codimd"target="_blank"rel="noopener">Codimd</a>。<p>在<a href="https://demo.codimd.org/"target="_blank"rel="noopener">demo.codimd.org</a>体验了几天非常不错。<p>支持多人实时在线编辑、简单的版本控制、样式简洁、公式、目录、代码高亮、各种图表支持的也非常到位。<p>但是看着域名中的 demo 害怕突然哪天跟 hackmd.io 一样打不开就完蛋了，家里星际蜗牛 24 小时开机，打算部署在黑群晖的 Docker 中。<h2 id="部署"><a href="#部署"class="headerlink"title="部署"></a>部署</h2><p>黑群晖没有装<code>docker-compose</code>，不过群晖的 Docker 控制台对新手也非常友好。<p>根据<a href="https://github.com/codimd/container"target="_blank"rel="noopener">https://github.com/codimd/container</a>仓库中的<code>docker-compose.yml</code>来简单配置一下就可以了。<p>提前拉一下需要的 images：<ol><li>MySQL （Docker 控制台 - 注册表 - 搜 MySQL - 下载 latest 就可以了）<li><code>quay.io/codimd/server:1.6.0</code>（Docker 控制台 - 映像 - 新增 - 从 URL 添加 ）</ol><h3 id="Docker-部署-MySQL"><a href="#Docker-部署-MySQL"class="headerlink"title="Docker 部署 MySQL"></a>Docker 部署 MySQL</h3><p>试了下 Mariadb，但是环境变量貌似无法生效，换成 MySQL 也一样。<ol><li>选中 MySQL 映像，启动。<li>勾选高权限、设置优先级（可选）<li>进入高级设置，自动重启勾上（可选）<li>选择“卷”映射数据目录到<code>/var/lib/mysql</code>，映射<a href="https://github.com/codimd/container/blob/master/resources/utf8.cnf"target="_blank"rel="noopener">uft8.cnf</a>到<code>/etc/mysql/conf.d/utf8.cnf</code><li>配置环境变量<ul><li><code>MYSQL_USER = hackmd</code><li><code>MYSQL_PASSWORD = xxxxxx</code><li><code>MYSQL_DATABSE = hackmd</code><li><code>MYSQL_ROOT_PASSWORD = xxx</code></ul><li>其余保持默认，应用。</ol><h3 id="Docker-部署-codimd-server"><a href="#Docker-部署-codimd-server"class="headerlink"title="Docker 部署 codimd/server"></a>Docker 部署 codimd/server</h3><ol><li>选中 MySQL 映像，启动。<li>勾选高权限、设置优先级（可选）<li>进入高级设置，自动重启勾上（可选）<li>端口映射自行按需配置<li>选择 “链接” 选择前面部署的 mysql 容器名称设置别名为<code>database</code><li>配置环境变量<ul><li><code>CMD_DB_URL = mysql:hackmd:xxx@database/hackmd</code>（格式为：<code>&lt;databasetype&gt;://&lt;username&gt;:&lt;password&gt;@&lt;hostname&gt;/&lt;database&gt;</code>自行修改）</ul><li>其余保持默认，应用。</ol><h3 id="验证"><a href="#验证"class="headerlink"title="验证"></a>验证</h3><p>分别查看 MySQL 、codimd/server 两个容器的日志有无错误信息。<p>MySQL 容器日志有<code>[Server] X Plugin ready for connections. Socket: &#39;/var/run/mysqld/mysqlx.sock&#39; bind-address: &#39;::&#39; port: 33060</code>类似即可。<p>codimd/server 容器日志有<code>HTTP Server listening at 0.0.0.0:3000</code>类似即可。</section></article><footer class="footer-container"><section>Copyright &copy; 2020&nbsp;<a href="mailto:zowiegong@gmail.com">zowiegong</a>&nbsp;Powered by&nbsp;<a href="https://github.com/hexojs/hexo"target="_blank"rel="noopener noreferrer">Hexo</a>&nbsp;Theme by&nbsp;<a href="https://github.com/zowiegong/hexo-theme-os"target="_blank"rel="noopener noreferrer">OS.</a><br><a href="https://github.com/zowiegong/hexo-blog/edit/master/source/_posts/群晖Docker部署Codimd.md"target="_blank">Edit source file</a></section></footer><div class="hover-pointer"id="scroll-to-top-container"><svg class="hover-fill"height="3rem "id="scroll-to-top-btn"version="1.1"viewBox="0 0 1024 1024"width="3rem"><path d="M825.568 555.328l-287.392-289.28C531.808 259.648 523.488 256.576 515.2 256.64 514.08 256.544 513.12 256 512 256c-4.672 0-9.024 1.088-13.024 2.88-4.032 1.536-7.872 3.872-11.136 7.136l-259.328 258.88c-12.512 12.48-12.544 32.736-0.032 45.248 6.24 6.272 14.432 9.408 22.656 9.408 8.192 0 16.352-3.136 22.624-9.344L480 364.288 480 928c0 17.696 14.336 32 32 32s32-14.304 32-32L544 362.72l236.192 237.728c6.24 6.272 14.496 9.44 22.688 9.44s16.32-3.104 22.56-9.312C838.016 588.128 838.048 567.84 825.568 555.328z"p-id="1100"></path><path d="M864 192 160 192C142.336 192 128 177.664 128 160s14.336-32 32-32l704 0c17.696 0 32 14.336 32 32S881.696 192 864 192z"p-id="1101"></path></svg></div><script>window.pluginsConfig = JSON.parse('{"googleAnalytics":"UA-121105508-1","scrollToTop":true,"scrollSmooth":false,"comments":{"enable":true,"repo":"zowiegong/hexo-blog"}}')</script><script>pluginsConfig.comments.enable = true</script><script src="/main.js"></script>